<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="chen wen jun's blog"><meta name="baidu-site-verification" content="no5dkv1A7T"><title>关于Promise | EL PSY CONGROO</title><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><script type="text/javascript" src="/js/main.js"></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/default.min.css"><script type="text/javascript" src="/js/post.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body></body><div id="header"><div class="body_container"><div id="nav-menu"><a class="current" href="/."> 主页</a><a href="/archives/"> 归档</a><a target="_blank" rel="noopener" href="https://next.yo-cwj.com"> 项目</a><a href="/about/"> 关于</a></div><div class="site-name"><img class="avatar" src="/./img/avatar.png"><div class="theme-selector"><div class="selector" onclick="document.body.className = 't1';localStorage.setItem('yo-cwj-theme', 't1')" style="background: #00c7ff;"></div><div class="selector" onclick="document.body.className = 't2';localStorage.setItem('yo-cwj-theme', 't2')" style="background: #ffe100;"></div><div class="selector" onclick="document.body.className = 't3';localStorage.setItem('yo-cwj-theme', 't3')" style="background: #55ff00;"></div></div><br><h1 class="hidden">关于Promise</h1><a id="logo" href="/.">EL PSY CONGROO</a><p class="description">陈文俊的博客</p><p class="links"><a target="_blank" rel="noopener" href="https://segmentfault.com/u/xpang"><img src="/./img/sf.ico"></a><a target="_blank" rel="noopener" href="https://github.com/cwj0417"><img src="/./img/github.png"></a><a target="_blank" rel="noopener" href="https://dribbble.com/fjonas"><img src="/./img/dribbble.ico"></a><a target="_blank" rel="noopener" href="https://weibo.com/2719310113"><img src="/./img/weibo.ico"></a></p></div></div></div><div class="body_container"><div class="pure-g" id="layout"><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="搜索内容或标题" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-paperclip"> </i>标签</div><div class="tagcloud"><a href="/tags/%E5%85%A5%E9%97%A8/" style="font-size: 20px;">入门</a> <a href="/tags/webpack/" style="font-size: 20px;">webpack</a> <a href="/tags/vue/" style="font-size: 19.5px;">vue</a> <a href="/tags/javascript/" style="font-size: 19px;">javascript</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" style="font-size: 18.5px;">翻译</a> <a href="/tags/%E6%B7%B1%E5%85%A5es6/" style="font-size: 18px;">深入es6</a> <a href="/tags/%E5%BA%94%E7%94%A8/" style="font-size: 17.5px;">应用</a> <a href="/tags/vue%E6%BA%90%E7%A0%81/" style="font-size: 17.5px;">vue源码</a> <a href="/tags/%E5%88%86%E6%9E%90/" style="font-size: 17.5px;">分析</a> <a href="/tags/%E5%BF%83%E7%90%86%E5%AD%A6/" style="font-size: 17px;">心理学</a> <a href="/tags/electron/" style="font-size: 17px;">electron</a> <a href="/tags/react/" style="font-size: 16.5px;">react</a> <a href="/tags/haha/" style="font-size: 16px;">haha</a> <a href="/tags/%E4%BA%BA%E6%A0%BC%E5%BF%83%E7%90%86%E5%AD%A6/" style="font-size: 16px;">人格心理学</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E8%A3%85%E9%A5%B0/" style="font-size: 16px;">博客装饰</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87/" style="font-size: 15.5px;">代码组织</a> <a href="/tags/%E8%B5%84%E6%9C%AC%E8%AE%BA/" style="font-size: 15.5px;">资本论</a> <a href="/tags/angular/" style="font-size: 15px;">angular</a> <a href="/tags/d3/" style="font-size: 15px;">d3</a> <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 15px;">小程序</a> <a href="/tags/ssr/" style="font-size: 15px;">ssr</a> <a href="/tags/nuxt/" style="font-size: 15px;">nuxt</a> <a href="/tags/ae-exp/" style="font-size: 14.5px;">ae exp</a> <a href="/tags/immer/" style="font-size: 14.5px;">immer</a> <a href="/tags/chrome-extension/" style="font-size: 14.5px;">chrome extension</a> <a href="/tags/codemirror/" style="font-size: 14.5px;">codemirror</a> <a href="/tags/vite/" style="font-size: 14.5px;">vite</a> <a href="/tags/ci/" style="font-size: 14.5px;">ci</a> <a href="/tags/github-action/" style="font-size: 14.5px;">github action</a> <a href="/tags/monorepo/" style="font-size: 14.5px;">monorepo</a> <a href="/tags/http/" style="font-size: 14.5px;">http</a> <a href="/tags/git/" style="font-size: 14.5px;">git</a> <a href="/tags/%E4%BA%94%E8%A1%8C%E5%85%AB%E5%8D%A6/" style="font-size: 14.5px;">五行八卦</a> <a href="/tags/vuex/" style="font-size: 14.5px;">vuex</a> <a href="/tags/redux/" style="font-size: 14.5px;">redux</a> <a href="/tags/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/" style="font-size: 14px;">年终总结</a> <a href="/tags/%E6%91%A9%E6%89%98%E8%BD%A6/" style="font-size: 14px;">摩托车</a> <a href="/tags/chrome-extension/" style="font-size: 14px;">chrome-extension</a> <a href="/tags/vscode/" style="font-size: 14px;">vscode</a> <a href="/tags/%E9%A2%9C%E8%89%B2/" style="font-size: 14px;">颜色</a> <a href="/tags/eslint/" style="font-size: 14px;">eslint</a> <a href="/tags/svg/" style="font-size: 14px;">svg</a> <a href="/tags/shortcuts/" style="font-size: 14px;">shortcuts</a> <a href="/tags/web/" style="font-size: 14px;">web</a> <a href="/tags/%E6%8A%93%E5%8C%85/" style="font-size: 14px;">抓包</a> <a href="/tags/hook/" style="font-size: 14px;">hook</a> <a href="/tags/typescript/" style="font-size: 14px;">typescript</a> <a href="/tags/%E9%81%93%E5%BE%B7%E6%83%85%E6%93%8D%E8%AE%BA/" style="font-size: 14px;">道德情操论</a> <a href="/tags/jenkins/" style="font-size: 14px;">jenkins</a> <a href="/tags/%E6%AD%A3%E5%88%99/" style="font-size: 14px;">正则</a> <a href="/tags/%E6%95%B0%E5%AD%A6%E7%9A%84%E9%9B%A8%E4%BC%9E%E4%B8%8B/" style="font-size: 14px;">数学的雨伞下</a> <a href="/tags/esbuild/" style="font-size: 14px;">esbuild</a> <a href="/tags/%E7%9B%B8%E5%AF%B9%E8%AE%BA/" style="font-size: 14px;">相对论</a> <a href="/tags/cordova/" style="font-size: 14px;">cordova</a> <a href="/tags/vite-plugin/" style="font-size: 14px;">vite-plugin</a> <a href="/tags/weex/" style="font-size: 14px;">weex</a> <a href="/tags/%E9%98%BF%E5%BE%B7%E5%8B%92/" style="font-size: 14px;">阿德勒</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-commenting-o"> </i>最近评论</div><div class="epcRecentComments" id="cyReping" role="cylabs" data-use="reping"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> </i>友情链接</div><div class="links"><a href="https://blog.csdn.net/u010416101" title="sean(大数据专家, 人工智能专家)" target="_blank">sean(大数据专家, 人工智能专家)</a><a href="https://blog.csdn.net/u012373815" title="abel(大数据专家, 人工智能专家)" target="_blank">abel(大数据专家, 人工智能专家)</a><a href="https://di1shuai.com/" title="bruce(大数据专家, 人工智能专家)" target="_blank">bruce(大数据专家, 人工智能专家)</a><a href="https://www.cnblogs.com/linxiyue/" title="邓雪(全栈开发专家)" target="_blank">邓雪(全栈开发专家)</a><a href="https://www.xilanhua-c7.top/" title="赵吉(后现代浪漫主义诗人)" target="_blank">赵吉(后现代浪漫主义诗人)</a><a href="https://blog.csdn.net/weixin_40413961" title="98年新栋(首席实习生)" target="_blank">98年新栋(首席实习生)</a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">关于Promise</h1><div class="post-meta">Jul 23, 2016<span> | </span><span class="category"><a href="/categories/%E5%B7%A5%E4%BD%9C%E7%AC%94%E8%AE%B0/">工作笔记</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 次阅读</span></span></div><div class="post-content"><p>promise的理解于实践场景</p>
<span id="more"></span>
<h2 id="关于本文"><a href="#关于本文" class="headerlink" title="关于本文"></a>关于本文</h2><p>这条是最后加上的, 本文语法来源都是正统的, 理解却是自己的经验产生的, 包括应用, 优缺点, 作用, <strong>可能与部分朋友意见不同或者与主流观点不同.</strong> </p>
<h2 id="关于异步"><a href="#关于异步" class="headerlink" title="关于异步"></a>关于异步</h2><p>人是这样的:  有时候想找人说话, 有时候想静静.<br>女神想找我聊天的时候我想静静, 等我响应女神的时候他已经准备洗澡了. 同步和异步只是等不等的区别.</p>
<p>我与别人有时候关于同步异步有不同的看法, 在我看来同步异步只是等与不等的区别, 本质是一样的, 只是处理方式不同.</p>
<h2 id="关于callback"><a href="#关于callback" class="headerlink" title="关于callback"></a>关于callback</h2><p>之所以谈一下异步是因为我认为callback与promise也是一样, promise只是一个处理方式的封装, 和callback之间是可以互相替代的.</p>
<h2 id="promise的优缺点"><a href="#promise的优缺点" class="headerlink" title="promise的优缺点"></a>promise的优缺点</h2><h3 id="promise的优点"><a href="#promise的优点" class="headerlink" title="promise的优点"></a>promise的优点</h3><h4 id="避免callback-hell"><a href="#避免callback-hell" class="headerlink" title="避免callback hell"></a>避免callback hell</h4><p>这是聪明的你第一个会想到的.<br>以下callback伪代码: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getSchoolInfo</span>(<span class="string">&#x27;spicyChickenScool&#x27;</span>, <span class="function">(<span class="params">schoolInfo</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">getGradeInfo</span>(<span class="number">2</span>, <span class="function">(<span class="params">gradeInfo</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">getClassInfo</span>(<span class="number">3</span>, (classInfo) &#123;</span><br><span class="line">            <span class="title function_">getStudent</span>(<span class="number">4</span>, <span class="function">(<span class="params">student</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="comment">//悄悄调查小姐姐的个人信息</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>如果以上获取信息的方式全是promise的话: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">getSchoolInfo</span>(<span class="string">&#x27;spicyChickenScool&#x27;</span>)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">schoolInfo</span> =&gt;</span> <span class="title function_">getGradeInfo</span>(<span class="number">2</span>))</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">gradeInfo</span> =&gt;</span> <span class="title function_">getClassInfo</span>(<span class="number">3</span>))</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">classInfo</span> =&gt;</span> <span class="title function_">getStudent</span>(<span class="number">4</span>))</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">student</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">//查出了小姐姐的梦想是成为校园偶像</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>光从美观上就已分出了胜负.</p>
<h4 id="避免callback的copy-paste代码"><a href="#避免callback的copy-paste代码" class="headerlink" title="避免callback的copy paste代码"></a>避免callback的copy paste代码</h4><p><strong>本条添加于2016&#x2F;07&#x2F;24</strong></p>
<p>promise把对成功失败的处理统一放在了回调中, 而callback可能反复调用一些方法的时候会需要重复一些代码.</p>
<p>举个简单的例子, 对用户的所有操作（给用户设置权限、更新用户数据、把用户加入某个缓存列表）, 强调一下有许多操作, 接受了用户参数以后要去获取用户的信息, 代码类似以下: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> updateUser = <span class="keyword">function</span>(<span class="params">uid, filed, value, callback</span>) &#123;</span><br><span class="line">    <span class="title function_">getUser</span>(uid, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span>(err) &#123;</span><br><span class="line">            callback &amp;&amp; <span class="title function_">callback</span>(<span class="literal">true</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="title function_">update</span>(uid, filed, value, <span class="keyword">function</span>(<span class="params">err, data</span>) &#123;</span><br><span class="line">                <span class="comment">//</span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)		</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="方便组织代码"><a href="#方便组织代码" class="headerlink" title="方便组织代码"></a>方便组织代码</h4><p>promise的形式就是为了组织代码而设计的, 下文将会仔细讲解各种实例.</p>
<h3 id="promise的缺点"><a href="#promise的缺点" class="headerlink" title="promise的缺点"></a>promise的缺点</h3><h4 id="兼容问题"><a href="#兼容问题" class="headerlink" title="兼容问题"></a>兼容问题</h4><p>promise是个憋了很久的东西了, 市面上也有不同版本和规范的promise实现, 而es2015明确表示了建议使用原生promise.<br>新的node项目可以安心使用, 对于浏览器端新东西还得做不少处理.</p>
<h4 id="模式问题"><a href="#模式问题" class="headerlink" title="模式问题"></a>模式问题</h4><p>怎么描述呢, 一但使用promise, 会发现非常不自由, 会期待各处返回值全是promise, 很明显大多数经典的、必须的api全是callback的, 必须包装他们, 这就成了负担, 当然新的api都已经包装成了promise.</p>
<h4 id="异常处理"><a href="#异常处理" class="headerlink" title="异常处理"></a>异常处理</h4><p>promise内部异常是需要在error callback中写的, 如果不写内部异常会不抛出导致程序莫名卡死, 查bug无从下手, 导致到处打log查问题的狼狈局面.<br>具体也会在下文中详细说明.</p>
<h2 id="promise的实际应用情景"><a href="#promise的实际应用情景" class="headerlink" title="promise的实际应用情景"></a>promise的实际应用情景</h2><h3 id="请求服务中有某个必须参数"><a href="#请求服务中有某个必须参数" class="headerlink" title="请求服务中有某个必须参数"></a>请求服务中有某个必须参数</h3><p>模拟场景:  某个服务封装了一些统计游戏数据的请求, 大部分请求（非所有）需要带上游戏信息, 游戏信息本身就是http请求来的.<br>在特殊情况下（比如页面初始化, 获取游戏信息慢了）, 服务存储的游戏信息为空, 可能产生 <code>getNewUser/game/undefined</code>类似的尴尬情况, 为处理类似情况,聪明的你可能会想到这些办法: </p>
<ul>
<li>设置timeout</li>
<li>查询错误重复查询</li>
<li>设置是否取到游戏信息的标识, 把后续的请求建立队列重新处理</li>
</ul>
<p>如此可能还有一些问题, 还是会产生有undefined的请求, 错误处理的不方便, 或许你聪明绝顶有更好的办法, 这里只是介绍下promise的使用场景, 并不是宗教战争.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取游戏信息的服务</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">changeGame</span> = game =&gt; <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="title function_">resolve</span>(&#123;</span><br><span class="line">        <span class="attr">game</span>:game</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//获取‘pokemon’这个游戏的信息, 其他需要游戏信息的服务取这里的数据就可以</span></span><br><span class="line"><span class="keyword">var</span> curGame = <span class="title function_">changeGame</span>(<span class="string">&#x27;pokemon&#x27;</span>);</span><br><span class="line"><span class="comment">//获取某个日期新增用户的服务</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">getNewUser</span> = date =&gt; curGame</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function"><span class="params">game</span> =&gt;</span> <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">resolve</span>(&#123;</span><br><span class="line">            <span class="attr">date</span>:date,</span><br><span class="line">            <span class="attr">game</span>:game.<span class="property">game</span>,</span><br><span class="line">            <span class="attr">newUser</span>:<span class="number">233</span></span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;));</span><br><span class="line"><span class="comment">//如此调用</span></span><br><span class="line"><span class="title function_">getNewUser</span>(<span class="string">&#x27;20160724&#x27;</span>)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function">(<span class="params">res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 我们获得了新增数据&#123;date: &#x27;20160724&#x27;, game: &#x27;pokemon&#x27;, newUser: 233 &#125;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>讲一下原理, changeGame的时候就会马上发起请求, 并且一但resolve,curGame就一直是resolve状态, 调用就能直接获得结果.<br>如果发生错误可以在changeGame处理, 也能把错误传递到外部的promise, 本例子就写得很残缺了.</p>
<h3 id="多组有依赖关系的请求"><a href="#多组有依赖关系的请求" class="headerlink" title="多组有依赖关系的请求"></a>多组有依赖关系的请求</h3><p>模拟场景:  获取一个班级列表里第一名学生的信息. （一组请求, 每组请求都有顺序了要求.）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//简单模拟获取班级最强的学生和获取学生信息</span></span><br><span class="line"><span class="keyword">var</span> <span class="title function_">getTopStudent</span> = clazz =&gt; <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(<span class="string">&#x27;top student in class&#x27;</span> + clazz);</span><br><span class="line"><span class="keyword">var</span> <span class="title function_">getStudentInfo</span> = student =&gt; <span class="title class_">Promise</span>.<span class="title function_">resolve</span>(&#123;</span><br><span class="line">    <span class="attr">name</span>:student,</span><br><span class="line">    <span class="attr">age</span>:<span class="number">18</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//假设班级列表</span></span><br><span class="line"><span class="keyword">var</span> classList = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="comment">//请求列表</span></span><br><span class="line"><span class="keyword">var</span> requests = [];</span><br><span class="line"><span class="comment">//开始请求</span></span><br><span class="line">classList.<span class="title function_">forEach</span>(<span class="function">(<span class="params">clazz</span>) =&gt;</span> &#123;</span><br><span class="line">    requests.<span class="title function_">push</span>(</span><br><span class="line">        <span class="title function_">getTopStudent</span>(clazz)</span><br><span class="line">            .<span class="title function_">then</span>(<span class="function"><span class="params">studentName</span> =&gt;</span> <span class="title function_">getStudentInfo</span>(studentName))</span><br><span class="line">    );</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//获取结果</span></span><br><span class="line"><span class="title class_">Promise</span>.<span class="title function_">all</span>(requests)</span><br><span class="line">    .<span class="title function_">then</span>(<span class="function">(<span class="params">results</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">//获得的结果为[ &#123; name: &#x27;top student in class1&#x27;, age: 18 &#125;,&#123; name: &#x27;top student in class2&#x27;, age: 18 &#125;,&#123; name: &#x27;top student in class3&#x27;, age: 18 &#125; ]</span></span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure>

<h2 id="其他细节"><a href="#其他细节" class="headerlink" title="其他细节"></a>其他细节</h2><ul>
<li>如果某一个请求依赖某个上上层的结果完全可以在回掉里进行下次请求, 并不是必须写成链式.</li>
<li>同时向多个服务器发起请求, 使用响应最快的数据<code>Promise.race()</code>, 一系列请求全部完成再处理数据<code>Promise.all()</code>.</li>
</ul>
</div><div class="post-footer"></div><p> (本文完)</p><p> 如果你觉得本文对你有帮助, 你可以<a href="/about/give-me-a-coffee.html">请我喝一杯咖啡</a></p><p> 本文遵循<a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0/deed.en">cc协议</a></p><p> 你可以在注明出处和非商用的前提下任意复制及演绎</p><div class="post-footer"></div><div class="tags"><a href="/tags/%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87/">代码组织</a><a href="/tags/javascript/">javascript</a></div><div class="post-nav"><a class="pre" href="/2016/08/08/angular-form/">Angular表单</a></div><div id="SOHUCS"></div></div></div></div><div class="pure-u-1 pure-u-md-4-4"><div id="footer"><p>©&nbsp;<a href="/." rel="nofollow">EL PSY CONGROO. </a><a rel="nofollow" target="_blank" href="http://www.miitbeian.gov.cn/">沪ICP备16053193号-2</a></p><p>Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> | Designed by hahahaha</p></div></div></div></div><script>document.body.className = localStorage.getItem('yo-cwj-theme') || 't1'
</script><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="https://cy-cdn.kuaizhan.com/js/??lib/jquery.js,changyan.labs.https.js?appid=cyt1bgEED" async></script><script>(function () {
    var appid = 'cyt1bgEED';
    var conf = 'prod_20e8d05c4d6b3ce62b89be98ae18390c';
    var width = window.innerWidth || document.documentElement.clientWidth;
    if (width < 960) {
        var head = document.getElementsByTagName('head')[0]||document.head||document.documentElement;
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.charset = 'utf-8';
        script.id = 'changyan_mobile_js';
        script.src = 'https://cy-cdn.kuaizhan.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf;
        head.appendChild(script);
    } else {
        var loadJs=function(d,a){
        var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;
        var b=document.createElement("script");
        b.setAttribute("type","text/javascript");
        b.setAttribute("charset","UTF-8");b.setAttribute("src",d);
        if(typeof a==="function"){
          if(window.attachEvent){
            b.onreadystatechange=function(){
              var e=b.readyState;
              if(e==="loaded"||e==="complete"){
                b.onreadystatechange=null;
                a();
              }
            }
            }else{
              b.onload=a
            }
          }
          c.appendChild(b)
        };
      loadJs("https://cy-cdn.kuaizhan.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})});
    }
})();
</script><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></html>