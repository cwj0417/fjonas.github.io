extends base

block title
  if page.category
     title= page.category + ' | ' + config.title
  if page.tag
     title= page.tag + ' | ' + config.title
  if page.archive
     title= __('archive') + ' | ' + config.title
block content
  .post-list
  include _partial/cats_nav
  if is_category()
    for post in page.posts.toArray()
      .post
        h2.post-title
          include _partial/helpers
          a(href=url_for(post.path))
            +title(post)
        .post-meta= post.date.format(config.date_format)
        if post.description
          .post-content
            != post.description
        else if post.excerpt
          .post-content
            != post.excerpt
        else if post.content
          - var br = post.content.indexOf('\n')
          if br < 0
            .post-content
              != post.content
          else
            .post-content
              != post.content.substring(0, br)
        p(class='readmore')
          a(href=url_for(post.path))= 'MORE'
  else
    .post
      .post-archive
        - var allposts = page.posts.toArray().reduce((r, v, i, a, k = -v.date.format('YYYY')) => ((r[k] || (r[k] = [])).push(v), r), {})
        each posts, year in allposts
          h2= -year
          ul.listing
            for post in posts
              li
                span.date= post.date.format(config.date_format)
                a(href=url_for(post.path), title=post.title)
                  +title(post)
  include _partial/paginator
