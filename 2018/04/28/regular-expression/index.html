<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="chen wen jun's blog"><meta name="baidu-site-verification" content="no5dkv1A7T"><title>正则从零到简单分析html标签 | EL PSY CONGROO</title><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/normalize/4.2.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/pure/0.6.0/grids-responsive-min.css"><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css"><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><script type="text/javascript" src="/js/main.js"></script><script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/highlight.min.js"></script><link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.6.0/styles/default.min.css"><script type="text/javascript" src="/js/post.js"></script><meta name="generator" content="Hexo 6.3.0"></head><body></body><div id="header"><div class="body_container"><div id="nav-menu"><a class="current" href="/."> 主页</a><a href="/archives/"> 归档</a><a target="_blank" rel="noopener" href="https://next.yo-cwj.com"> 项目</a><a href="/about/"> 关于</a></div><div class="site-name"><img class="avatar" src="/./img/avatar.png"><div class="theme-selector"><div class="selector" onclick="document.body.className = 't1';localStorage.setItem('yo-cwj-theme', 't1')" style="background: #00c7ff;"></div><div class="selector" onclick="document.body.className = 't2';localStorage.setItem('yo-cwj-theme', 't2')" style="background: #ffe100;"></div><div class="selector" onclick="document.body.className = 't3';localStorage.setItem('yo-cwj-theme', 't3')" style="background: #55ff00;"></div></div><br><h1 class="hidden">正则从零到简单分析html标签</h1><a id="logo" href="/.">EL PSY CONGROO</a><p class="description">陈文俊的博客</p><p class="links"><a target="_blank" rel="noopener" href="https://segmentfault.com/u/xpang"><img src="/./img/sf.ico"></a><a target="_blank" rel="noopener" href="https://github.com/cwj0417"><img src="/./img/github.png"></a><a target="_blank" rel="noopener" href="https://dribbble.com/fjonas"><img src="/./img/dribbble.ico"></a><a target="_blank" rel="noopener" href="https://weibo.com/2719310113"><img src="/./img/weibo.ico"></a></p></div></div></div><div class="body_container"><div class="pure-g" id="layout"><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="搜索内容或标题" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-paperclip"> </i>标签</div><div class="tagcloud"><a href="/tags/%E5%85%A5%E9%97%A8/" style="font-size: 20px;">入门</a> <a href="/tags/webpack/" style="font-size: 20px;">webpack</a> <a href="/tags/vue/" style="font-size: 19.57px;">vue</a> <a href="/tags/javascript/" style="font-size: 19.14px;">javascript</a> <a href="/tags/%E7%BF%BB%E8%AF%91/" style="font-size: 18.71px;">翻译</a> <a href="/tags/%E6%B7%B1%E5%85%A5es6/" style="font-size: 18.29px;">深入es6</a> <a href="/tags/vue%E6%BA%90%E7%A0%81/" style="font-size: 17.86px;">vue源码</a> <a href="/tags/%E5%BA%94%E7%94%A8/" style="font-size: 17.43px;">应用</a> <a href="/tags/%E5%88%86%E6%9E%90/" style="font-size: 17.43px;">分析</a> <a href="/tags/%E5%BF%83%E7%90%86%E5%AD%A6/" style="font-size: 17px;">心理学</a> <a href="/tags/electron/" style="font-size: 17px;">electron</a> <a href="/tags/react/" style="font-size: 16.57px;">react</a> <a href="/tags/haha/" style="font-size: 16.14px;">haha</a> <a href="/tags/%E4%BA%BA%E6%A0%BC%E5%BF%83%E7%90%86%E5%AD%A6/" style="font-size: 15.71px;">人格心理学</a> <a href="/tags/%E5%8D%9A%E5%AE%A2%E8%A3%85%E9%A5%B0/" style="font-size: 15.71px;">博客装饰</a> <a href="/tags/%E4%BB%A3%E7%A0%81%E7%BB%84%E7%BB%87/" style="font-size: 15.29px;">代码组织</a> <a href="/tags/%E8%A7%A3%E9%87%8A%E8%84%91/" style="font-size: 15.29px;">解释脑</a> <a href="/tags/%E8%B5%84%E6%9C%AC%E8%AE%BA/" style="font-size: 15.29px;">资本论</a> <a href="/tags/angular/" style="font-size: 14.86px;">angular</a> <a href="/tags/d3/" style="font-size: 14.86px;">d3</a> <a href="/tags/%E5%B0%8F%E7%A8%8B%E5%BA%8F/" style="font-size: 14.86px;">小程序</a> <a href="/tags/hama/" style="font-size: 14.86px;">hama</a> <a href="/tags/ssr/" style="font-size: 14.86px;">ssr</a> <a href="/tags/nuxt/" style="font-size: 14.86px;">nuxt</a> <a href="/tags/ae-exp/" style="font-size: 14.43px;">ae exp</a> <a href="/tags/immer/" style="font-size: 14.43px;">immer</a> <a href="/tags/chrome-extension/" style="font-size: 14.43px;">chrome extension</a> <a href="/tags/codemirror/" style="font-size: 14.43px;">codemirror</a> <a href="/tags/vite/" style="font-size: 14.43px;">vite</a> <a href="/tags/ci/" style="font-size: 14.43px;">ci</a> <a href="/tags/github-action/" style="font-size: 14.43px;">github action</a> <a href="/tags/monorepo/" style="font-size: 14.43px;">monorepo</a> <a href="/tags/http/" style="font-size: 14.43px;">http</a> <a href="/tags/git/" style="font-size: 14.43px;">git</a> <a href="/tags/%E4%BA%94%E8%A1%8C%E5%85%AB%E5%8D%A6/" style="font-size: 14.43px;">五行八卦</a> <a href="/tags/vuex/" style="font-size: 14.43px;">vuex</a> <a href="/tags/redux/" style="font-size: 14.43px;">redux</a> <a href="/tags/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/" style="font-size: 14px;">年终总结</a> <a href="/tags/%E6%91%A9%E6%89%98%E8%BD%A6/" style="font-size: 14px;">摩托车</a> <a href="/tags/chrome-extension/" style="font-size: 14px;">chrome-extension</a> <a href="/tags/vscode/" style="font-size: 14px;">vscode</a> <a href="/tags/%E9%A2%9C%E8%89%B2/" style="font-size: 14px;">颜色</a> <a href="/tags/eslint/" style="font-size: 14px;">eslint</a> <a href="/tags/svg/" style="font-size: 14px;">svg</a> <a href="/tags/shortcuts/" style="font-size: 14px;">shortcuts</a> <a href="/tags/web/" style="font-size: 14px;">web</a> <a href="/tags/%E6%8A%93%E5%8C%85/" style="font-size: 14px;">抓包</a> <a href="/tags/hook/" style="font-size: 14px;">hook</a> <a href="/tags/typescript/" style="font-size: 14px;">typescript</a> <a href="/tags/%E9%81%93%E5%BE%B7%E6%83%85%E6%93%8D%E8%AE%BA/" style="font-size: 14px;">道德情操论</a> <a href="/tags/jenkins/" style="font-size: 14px;">jenkins</a> <a href="/tags/%E6%AD%A3%E5%88%99/" style="font-size: 14px;">正则</a> <a href="/tags/%E6%95%B0%E5%AD%A6%E7%9A%84%E9%9B%A8%E4%BC%9E%E4%B8%8B/" style="font-size: 14px;">数学的雨伞下</a> <a href="/tags/esbuild/" style="font-size: 14px;">esbuild</a> <a href="/tags/%E7%9B%B8%E5%AF%B9%E8%AE%BA/" style="font-size: 14px;">相对论</a> <a href="/tags/cordova/" style="font-size: 14px;">cordova</a> <a href="/tags/vite-plugin/" style="font-size: 14px;">vite-plugin</a> <a href="/tags/%E9%98%BF%E5%BE%B7%E5%8B%92/" style="font-size: 14px;">阿德勒</a> <a href="/tags/weex/" style="font-size: 14px;">weex</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-commenting-o"> </i>最近评论</div><div class="epcRecentComments" id="cyReping" role="cylabs" data-use="reping"></div></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> </i>友情链接</div><div class="links"><a href="https://blog.csdn.net/u010416101" title="sean(大数据专家, 人工智能专家)" target="_blank">sean(大数据专家, 人工智能专家)</a><a href="https://blog.csdn.net/u012373815" title="abel(大数据专家, 人工智能专家)" target="_blank">abel(大数据专家, 人工智能专家)</a><a href="https://di1shuai.com/" title="bruce(大数据专家, 人工智能专家)" target="_blank">bruce(大数据专家, 人工智能专家)</a><a href="https://www.cnblogs.com/linxiyue/" title="邓雪(全栈开发专家)" target="_blank">邓雪(全栈开发专家)</a><a href="https://www.xilanhua-c7.top/" title="赵吉(后现代浪漫主义诗人)" target="_blank">赵吉(后现代浪漫主义诗人)</a><a href="https://blog.csdn.net/weixin_40413961" title="98年新栋(首席实习生)" target="_blank">98年新栋(首席实习生)</a></div></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">正则从零到简单分析html标签</h1><div class="post-meta">Apr 28, 2018<span> | </span><span class="category"><a href="/categories/%E5%B7%A5%E4%BD%9C%E7%AC%94%E8%AE%B0/">工作笔记</a></span><script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" async></script><span id="busuanzi_container_page_pv"> | <span id="busuanzi_value_page_pv"></span><span> 次阅读</span></span></div><div class="post-content"><p>对于正则之前一直是一个”百度程序员”, 也许超过一半甚至更多的程序员也是, 那么这次来学习一下正则表达式.</p>
<span id="more"></span>

<h2 id="事出有因"><a href="#事出有因" class="headerlink" title="事出有因"></a>事出有因</h2><p>这部分介绍一下需求的由来, 与主要内容无关.</p>
<p>工作上有了这样的需求: </p>
<p>web端从ueditor来的数据格式是html, 也就是<code>&lt;p&gt;文章内容&lt;/p&gt;</code>, 并夹杂着诸多标签和嵌套. </p>
<p>然而正在开发的是react-native项目, rn的标签和html完全不兼容, 是<code>View, Text, Image</code>等. </p>
<p>那么把从web存入的数据读取到rn上就出了大麻烦, 甚至有些地方要进行跳转, 有些图片要显示, 那么怎么办呢.</p>
<p>通过百度”js如何验证邮箱”已经无法满足需求了, 只能学一下了.</p>
<h2 id="目标"><a href="#目标" class="headerlink" title="目标"></a>目标</h2><p>万事有目标, 我们要把一下内容转换成rn的内容:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>嘿嘿嘿<span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;currentImg&quot;</span> <span class="attr">id</span>=<span class="string">&quot;currentImg&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1524647151050&amp;di=d488d0e93e72f13643d843066ef26836&amp;imgtype=0&amp;src=http%3A%2F%2Fimg02.imgcdc.com%2Fgame%2Fzh_cn%2Fpicnews%2F11128819%2F20160518%2F22678501_20160518152946632994008.jpg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;201.33333333333&quot;</span> <span class="attr">height</span>=<span class="string">&quot;302&quot;</span> <span class="attr">title</span>=<span class="string">&quot;点击查看源网页&quot;</span>/&gt;</span>拖过来的图片哦<span class="tag">&lt;<span class="name">img</span> <span class="attr">class</span>=<span class="string">&quot;currentImg&quot;</span> <span class="attr">id</span>=<span class="string">&quot;currentImg&quot;</span> <span class="attr">src</span>=<span class="string">&quot;https://timgsa.baidu.com/timg?image&amp;quality=80&amp;size=b9999_10000&amp;sec=1524647205890&amp;di=5bf77e1d35941def729d2059d91deba8&amp;imgtype=0&amp;src=http%3A%2F%2Fnds.tgbus.com%2FUploadFiles%2F201208%2F20120817142937519.jpg&quot;</span> <span class="attr">width</span>=<span class="string">&quot;201.17405063291&quot;</span> <span class="attr">height</span>=<span class="string">&quot;302&quot;</span> <span class="attr">title</span>=<span class="string">&quot;点击查看源网页&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span>a<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">‘test1’</span> /&gt;</span>b<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">‘test2’</span> /&gt;</span>c<span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">‘test3’</span> /&gt;</span>d<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>转换结果是: </p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Text</span>&gt;</span>嘿嘿嘿<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">source</span>=<span class="string">&#123;&#123;uri:</span> &#x27;<span class="attr">https:</span>//<span class="attr">timgsa.baxxxx</span>&#x27;&#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">Image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Text</span>&gt;</span>拖过来的图片哦<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">source</span>=<span class="string">&#123;&#123;uri:</span> &#x27;<span class="attr">https:</span>//<span class="attr">txx</span>&#x27;&#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">Image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Text</span>&gt;</span>a<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Image</span> <span class="attr">source</span>=<span class="string">&#123;&#123;uri:</span> &#x27;<span class="attr">test1</span>&#x27;&#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">Image</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Text</span>&gt;</span>b<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>本文会从零基础出发达成这个目标.</p>
<p>讲解顺序: 正则介绍 &#x3D;&gt; 正则语法系统 &#x3D;&gt; 简单的例子讲解 &#x3D;&gt; 尝试实现目标以及碰到的问题 &#x3D;&gt; 实现目标</p>
<h2 id="什么是正则"><a href="#什么是正则" class="headerlink" title="什么是正则"></a>什么是正则</h2><p>初中时候学的通配符, 用<code>?</code>代表一个任意字符, 用<code>*</code>代表任意个任意字符来进行搜索, 正则也是如此. 比如:</p>
<p><code>123[abc]</code>匹配以下哪组字符?</p>
<ol>
<li>123c</li>
<li>123d</li>
<li>123e</li>
<li>123f</li>
</ol>
<p>选了1的朋友你已经知道正则是什么了. <code>123[abc]</code>就是正则, 代表匹配内容为: 前三个字符分别为123, 第四个字符是abc中的一个, 这个正则遇到<code>123a</code>, <code>123b</code>, <code>123c</code>都可以匹配成功, 其他任何都匹配失败.</p>
<h2 id="正则语法"><a href="#正则语法" class="headerlink" title="正则语法"></a>正则语法</h2><p>百度了正则表达式看到的东西都用了很多术语, 让人有点犯浑. 我经过学习把正则抽象为两个部分: <code>内容</code>和<code>修饰</code>.</p>
<p>看到一长串正则觉得稀里哗啦, 但是里面的每个符号一定都属于<code>内容</code>或是<code>修饰</code>.</p>
<h3 id="内容"><a href="#内容" class="headerlink" title="内容"></a>内容</h3><p>内容的形式有3种: </p>
<ol>
<li>直接匹配: 举例就是刚才的<code>123[abc]</code>中的<code>123</code>, 这种匹配需要完全吻合才能匹配, <code>123</code>就唯一匹配<code>123</code>.</li>
<li>范围匹配: 用中括号表示, 也就是刚才例子中的<code>[abc]</code>. 这种情况也就是三选一. 任意匹配<code>a</code>或<code>b</code>或<code>c</code>, 而不是匹配<code>abc</code>. 还有两种形式: 加<code>-</code>来表示范围, 比如<code>[a-z]</code>; 表示排除范围内的<code>^</code>, 比如<code>[^abc]</code></li>
<li>匹配并选择缓存到子匹配: 用圆括号表示, 圆括号中的内容语法是”直接匹配”但会被记入缓存作为子匹配, 我记得我最初接触正则就是url rewrite, 写了url正则之后用<code>$1, $2</code>来重写url.</li>
</ol>
<p>在范围匹配中, 我们经常会用: 数字&#x2F;字母, 也就是<code>[0-9]</code>, <code>[a-zA-Z]</code>, 但是经常用到重复地写麻烦又看不能装逼了, 所以产生了一些快捷方式: <code>\d</code>代表<code>[0-9]</code>, <code>\w</code>代表<code>[0-9a-zA-Z_]</code>这正好是常用的用户名和密码的规则.</p>
<p>这里深入一下圆括号匹配的两个点. 作为拓展, 可以先不看一下的内容直接到下一部分.</p>
<p>因为圆括号中可以用<code>|</code>符号来表示或的关系, 但有时候又不想被加入缓存. 于是可以用<code>?:</code>来表示不需要缓存. 例子:<code>hello (?:world|regular expression)</code>, 用来匹配<code>hello world</code>或者<code>hello regular expression</code>, 但又不需要把<code>world</code>储存为缓存.</p>
<p>如果之前已经用圆括号, 那么期望之后出现同样的内容, 可以用<code>\1</code>这样<code>\</code>加数字来表示. 举个例子: 单引号和双引号, 我们要匹配<code>&#39;123&#39;</code>或者<code>&quot;123&quot;</code>, 但是要保持引号一致.  <code>(&#39;|&quot;)123\1</code>就可以解决问题.</p>
<h3 id="修饰"><a href="#修饰" class="headerlink" title="修饰"></a>修饰</h3><p>我把修饰部分分为数量修饰和边界修饰.</p>
<ol>
<li><p>数量修饰: 符号为{}, 想到了谷歌: <code>go&#123;2,4&#125;gle</code>这个正则可以匹配<code>google</code>, <code>gooogle</code>, <code>goooogle</code>, 代表这个<code>o</code>可以匹配2或者4次. 当然只是为了举例可以枚举, 因为<code>go&#123;2,&#125;gle</code>代表可以无限个<code>o</code>, 这样举例不方便.</p>
<p>与之前的范围匹配一样, 数量修饰也有快捷符号: <code>?</code>代表{0,1}, <code>*</code>代表{0,}, <code>+</code>代表{1,}. 都很形象, 不用死记, 就像刚才的d for digital, w for word. 看过一个例子: <code>colou?r</code> 这里的<code>?</code>表示可有可无, 美式和英式的拼写都可以匹配.</p>
<p>另外在”无上限”的数量的右边加<code>?</code>代表不贪婪匹配, 会匹配数量最少的内容. 举例: <code>a+</code>匹配<code>aaaaa</code>的结果为<code>aaaaa</code>, <code>a+?</code>匹配<code>aaaaa</code>的结果为<code>a</code>.</p>
</li>
<li><p>边界修饰: <code>^</code>表示字符串的头, <code>$</code>表示字符串的尾, <code>\b</code>表示字母与空格间的位置. 用来给匹配定位, 具体用法在实际中操作就会有具体感受了.</p>
<p>另外, 正则有一种匹配模式是<code>m</code>, 多行匹配模式, 这个情况里<code>^</code>和<code>$</code>也能匹配每一行的开头和结尾.</p>
</li>
</ol>
<h2 id="javascript相关函数"><a href="#javascript相关函数" class="headerlink" title="javascript相关函数"></a>javascript相关函数</h2><p>首先明确正则是”正则表达式”与”字符串”发生的匹配关系.</p>
<p>js有个对象是<code>RegExp</code>, 使用方法是<code>new RegExp(pattern, mode)</code>, 或者是用<code>/</code>包裹的字面量: <code>/pattern/mode</code>.</p>
<p>这里发现提到了<code>mode</code>匹配模式, 一共三种:</p>
<ol>
<li>g: 全局匹配, 匹配到一次不会停止, <code>/a/</code>匹配<code>aaa</code>, 如果没有g结果是一个<code>a</code>, 有g结果是3个<code>a</code>.</li>
<li>i: 忽略大小写.</li>
<li>m: 多行模式. 和之前提到的<code>\b</code>有联动.</li>
</ol>
<p>三个模式不互斥, 叠加的, 也就是可以<code>new RegExp(patter, &#39;gin&#39;)</code>.</p>
<p>正则的方法有:</p>
<ol>
<li><code>.test()</code>: 返回是否匹配成功, true或者false.</li>
<li><code>.exec()</code>: 失败返回null, 成功返回数组, 位置0是匹配内容, 之后是圆括号匹配的内容. 要注意的是exec是忽略’g’模式的.</li>
</ol>
<p>字符串的方法:</p>
<ol>
<li><code>.replace(pattern, replacement)</code>: replacement可以字符串或方法, 方法的话参数是匹配到的内容.</li>
<li><code>.match(pattern)</code>: 返回数组, 所有匹配到的内容.</li>
</ol>
<h2 id="分析一些简单常用的例子"><a href="#分析一些简单常用的例子" class="headerlink" title="分析一些简单常用的例子"></a>分析一些简单常用的例子</h2><h3 id="是否小数"><a href="#是否小数" class="headerlink" title="是否小数"></a>是否小数</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isDecimal</span>(<span class="params">strValue </span>)  &#123;  </span><br><span class="line">   <span class="keyword">var</span>  objRegExp= <span class="regexp">/^\d+\.\d+$/</span>;</span><br><span class="line">   <span class="keyword">return</span>  objRegExp.<span class="title function_">test</span>(strValue);  </span><br><span class="line">&#125;  </span><br></pre></td></tr></table></figure>

<p><code>\d</code>代表数字, <code>+</code>代表至少有1个数字,  <code>\.</code>转移小数点.</p>
<p>连起来看就是: 至少一个数字(<code>\d+</code>) 小数点(<code>\.</code>) 至少一个数字(<code>\d+</code>) .</p>
<p><code>^</code>和<code>$</code>代表头尾, 真个字符串是小数的全部, 而不是包含小数.</p>
<h3 id="是否中文名"><a href="#是否中文名" class="headerlink" title="是否中文名"></a>是否中文名</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">ischina</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> reg=<span class="regexp">/^[\u4E00-\u9FA5]&#123;2,4&#125;$/</span>;   <span class="comment">/*定义验证表达式*/</span></span><br><span class="line">    <span class="keyword">return</span> reg.<span class="title function_">test</span>(str);     <span class="comment">/*进行验证*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个范围是中文的编码范围: <code>[\u4E00-\u9FA5]</code>, <code>&#123;2,4&#125;</code>匹配2<del>4个. 也就是匹配2</del>4个中文.</p>
<h3 id="是否八位数字"><a href="#是否八位数字" class="headerlink" title="是否八位数字"></a>是否八位数字</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isStudentNo</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> reg=<span class="regexp">/^\d&#123;8&#125;$/</span>;   <span class="comment">/*定义验证表达式*/</span></span><br><span class="line">    <span class="keyword">return</span> reg.<span class="title function_">test</span>(str);     <span class="comment">/*进行验证*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="是否电话号码"><a href="#是否电话号码" class="headerlink" title="是否电话号码"></a>是否电话号码</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">isTelCode</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> reg= <span class="regexp">/^((0\d&#123;2,3&#125;-\d&#123;7,8&#125;)|(1[3584]\d&#123;9&#125;))$/</span>;</span><br><span class="line">    <span class="keyword">return</span> reg.<span class="title function_">test</span>(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>分两个部分: 座机号和手机号, 用<code>|</code>隔开了.</p>
<p>座机号: 0开头的三位数或四位数 短杠 7~8位数字.</p>
<p>手机号: 第一位1, 第二位3584的一个, 剩下由9个数字凑满11位电话.</p>
<h3 id="邮箱地址"><a href="#邮箱地址" class="headerlink" title="邮箱地址"></a>邮箱地址</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">IsEmail</span>(<span class="params">str</span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> reg=<span class="regexp">/^([a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+(\.[a-zA-Z0-9_-])+$/</span>;</span><br><span class="line">    <span class="keyword">return</span> reg.<span class="title function_">test</span>(str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="迈向目标"><a href="#迈向目标" class="headerlink" title="迈向目标"></a>迈向目标</h2><p>这个章节开始整理实现需求的思路.</p>
<p>先回忆一下正则的规则, 其实很简单, 和加减乘除一样, 有各种符号: [], (), |, -, {}, +, *, ?. 当然也可以很复杂, 因为也和加减乘除一样, 可以嵌套, 而正则的符号本来就多, 嵌套起来更是晕, 有一些符号在不同地方有不同作用, 比如<code>\</code>和<code>^</code>.(思考题: 分析一下这两个符号有哪些作用, 在什么场景).</p>
<p>那么我们的目标是: 把一段html分析称rn的标签.</p>
<p>因为rn没有parse的功能, 所以不可以使用replace. (replace是代码高亮的常用手段).</p>
<p>所以我们必须把html分解成js对象, 再从js对象里去分析输出rn标签.</p>
<p>因为html标签分为多种, 为了保证完整性和可维护性, 要把各个标签的正则分开写, 也便于之后在分析每个片段的时候来取子匹配, 比如img标签的src, a标签的href.</p>
<p>经过研究, 正则是不可以拼接的, 只有字符串可以拼接. 所以我们要把不同标签的正则写成字符串, 再在需要的时候拼接. <code>new RegExp(pattern)</code>的pattern参数是可以接受字符串的.</p>
<h2 id="匹配text的难题与正则匹配的动作分析"><a href="#匹配text的难题与正则匹配的动作分析" class="headerlink" title="匹配text的难题与正则匹配的动作分析"></a>匹配text的难题与正则匹配的动作分析</h2><p>众所周知, 在html里的text是可以光秃秃的(在rn里必须加上Text标签). 那么如何匹配这光秃秃的东西呢, 我开始想了一个办法: 因为text都在标签之外, 也就是”夹在&gt;和&lt;中的字符”, 或者在开头(^)和&lt;间的, 或者&gt;和结尾($)间的. 结果标签全都匹配不到了.</p>
<p>原因是这样的, 如果有’g’的模式, 匹配的过程是这样的: </p>
<ol>
<li>进行第一次匹配, 匹配成功后把匹配部分排除待匹配内容.</li>
<li>进行第二次匹配, 匹配成功后把匹配部分排除待匹配内容.</li>
<li>直到匹配失败, 返回所有结果.</li>
</ol>
<p>举个例子: </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;applebananaapple&#x27;</span>.<span class="title function_">match</span>(<span class="regexp">/(apple|banana)/g</span>)</span><br></pre></td></tr></table></figure>

<p>结果是<code>[&quot;apple&quot;, &quot;banana&quot;, &quot;apple&quot;]</code></p>
<p>如果把banana的最后一个字母和apple的第一个字母写成一个:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;applebananapple&#x27;</span>.<span class="title function_">match</span>(<span class="regexp">/(apple|banana)/g</span>)</span><br></pre></td></tr></table></figure>

<p>那么结果就是<code>[&quot;apple&quot;, &quot;banana&quot;]</code>了.</p>
<p>反而利用了这个特点, 把text的正则写成: 不包含<code>&lt;&gt;/</code> (<code>[^&lt;&gt;/]+</code>), 并添加在最后一个匹配, 就能正确地匹配出text啦.</p>
<h2 id="揭晓答案"><a href="#揭晓答案" class="headerlink" title="揭晓答案"></a>揭晓答案</h2><p>写得急促也许有遗漏, 最后贴上完成需求的代码, 语言是rn, 在map输出的时候带着一些项目业务的逻辑请无视.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="title class_">React</span>, &#123;<span class="title class_">Component</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;<span class="title class_">Text</span>, <span class="title class_">View</span>, <span class="title class_">Image</span>, <span class="title class_">Platform</span>, <span class="title class_">StyleSheet</span>, <span class="title class_">TouchableOpacity</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;react-native&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123;<span class="variable constant_">ENVS</span>&#125; <span class="keyword">from</span> <span class="string">&#x27;../../config/apiHost&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    必须props: @html: html内容</span></span><br><span class="line"><span class="comment">    可选props:  @style: 字体style; @magnifyImg: 显示大图</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> regex = &#123;  <span class="comment">// &#x27;_&#x27; for close tag</span></span><br><span class="line">    <span class="attr">p</span>: <span class="string">`&lt;p[^&gt;]*?&gt;`</span>,</span><br><span class="line">    <span class="attr">_p</span>: <span class="string">`&lt;\/p&gt;`</span>,</span><br><span class="line">    <span class="attr">span</span>: <span class="string">`&lt;span[^&gt;]*?&gt;`</span>,</span><br><span class="line">    <span class="attr">_span</span>: <span class="string">`&lt;\/span&gt;`</span>,</span><br><span class="line">    <span class="attr">br</span>: <span class="string">`&lt;br\/&gt;`</span>,</span><br><span class="line">    <span class="attr">a</span>: <span class="string">`&lt;a[^&gt;]*?href=(\&#x27;|&quot;)([^&gt;]+?)\\1[^&gt;]*?&gt;([^&lt;]+?)&lt;\\/a&gt;`</span>, <span class="comment">// $1 是标点符号用来处理匹配 $2 href的带引号的内容 $3 文件名(a标签的innerText),</span></span><br><span class="line">    <span class="attr">img</span>: <span class="string">`&lt;img[^&gt;]*?src=(&#x27;|&quot;)([^&gt;]+?)\\1[^&gt;]*?\\/&gt;`</span>, <span class="comment">// $1 标点符号 $2 src的内容</span></span><br><span class="line">    <span class="attr">text</span>: <span class="string">`[^&lt;&gt;/]+`</span>, <span class="comment">// 匹配剩下的, 一定要放在最后</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> tobeRemoved = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">`(?:<span class="subst">$&#123;[regex.p, regex._p, regex.span, regex._span, regex.br].join(<span class="string">&#x27;|&#x27;</span>)&#125;</span>)`</span>, <span class="string">&#x27;g&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> parseToAst = <span class="keyword">new</span> <span class="title class_">RegExp</span>(<span class="string">`(?:<span class="subst">$&#123;[regex.a, regex.img, regex.text].join(<span class="string">&#x27;|&#x27;</span>)&#125;</span>)`</span>, <span class="string">&#x27;g&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">class</span> <span class="title class_">Parsed</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Component</span> &#123;</span><br><span class="line">    <span class="title function_">render</span> () &#123;</span><br><span class="line">        <span class="keyword">let</span> str = <span class="variable language_">this</span>.<span class="property">props</span>.<span class="property">html</span>.<span class="title function_">trim</span>()</span><br><span class="line">        <span class="keyword">if</span> (!str) &#123;</span><br><span class="line">            <span class="keyword">return</span> (</span><br><span class="line">                <span class="language-xml"><span class="tag">&lt;<span class="name">Text</span>&gt;</span>html attr not passed to component &#x27;parseHtml&#x27;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></span><br><span class="line">            )</span><br><span class="line">        &#125;</span><br><span class="line">        matches = str.<span class="title function_">replace</span>(tobeRemoved, <span class="string">&#x27;&#x27;</span>).<span class="title function_">match</span>(parseToAst)</span><br><span class="line">        <span class="keyword">return</span> (</span><br><span class="line">            <span class="language-xml"><span class="tag">&lt;<span class="name">View</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                &#123;matches.map((block, index) =&gt; &#123;</span></span><br><span class="line"><span class="language-xml">                    for (let [key, value] of Object.entries(regex)) &#123;</span></span><br><span class="line"><span class="language-xml">                        let res = new RegExp(value).exec(block)</span></span><br><span class="line"><span class="language-xml">                        if (res) &#123;</span></span><br><span class="line"><span class="language-xml">                            if (key === &#x27;text&#x27;) &#123;</span></span><br><span class="line"><span class="language-xml">                                return (</span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;<span class="name">Text</span> <span class="attr">style</span>=<span class="string">&#123;this.props.style&#125;</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span>&gt;</span>&#123;block&#125;<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                )</span></span><br><span class="line"><span class="language-xml">                            &#125;</span></span><br><span class="line"><span class="language-xml">                            if (key === &#x27;a&#x27;) &#123;</span></span><br><span class="line"><span class="language-xml">                                if (res[2].includes(&#x27;files&#x27;)) &#123; // 判断附件</span></span><br><span class="line"><span class="language-xml">                                    if (/[jpg|png|jpeg]/i.test(res[3])) &#123; // 判断图片</span></span><br><span class="line"><span class="language-xml">                                        let imgId = res[2].match(/\d+/)[0]</span></span><br><span class="line"><span class="language-xml">                                        return (</span></span><br><span class="line"><span class="language-xml">                                            <span class="tag">&lt;<span class="name">TouchableOpacity</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;this.props.magnifyImg &amp;&amp; this.props.magnifyImg(ENVS.production.api_base_url + &#x27;/files/&#x27; + imgId)&#125;&#125; &gt;</span></span><br><span class="line"><span class="language-xml">                                                <span class="tag">&lt;<span class="name">Image</span> <span class="attr">style</span>=<span class="string">&#123;&#123;width:</span> <span class="attr">100</span>, <span class="attr">height:</span> <span class="attr">100</span>, <span class="attr">margin:</span> <span class="attr">10</span>&#125;&#125; <span class="attr">source</span>=<span class="string">&#123;&#123;uri:</span> <span class="attr">ENVS.production.api_base_url</span> + &#x27;/<span class="attr">files</span>/&#x27; + <span class="attr">imgId</span>&#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">Image</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                            <span class="tag">&lt;/<span class="name">TouchableOpacity</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                        )</span></span><br><span class="line"><span class="language-xml">                                    &#125;</span></span><br><span class="line"><span class="language-xml">                                &#125;</span></span><br><span class="line"><span class="language-xml">                            &#125;</span></span><br><span class="line"><span class="language-xml">                            if (key === &#x27;img&#x27;) &#123;</span></span><br><span class="line"><span class="language-xml">                                return (</span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;<span class="name">TouchableOpacity</span> <span class="attr">key</span>=<span class="string">&#123;index&#125;</span> <span class="attr">onPress</span>=<span class="string">&#123;()</span> =&gt;</span> &#123;this.props.magnifyImg &amp;&amp; this.props.magnifyImg(res[2])&#125;&#125;&gt;</span></span><br><span class="line"><span class="language-xml">                                        <span class="tag">&lt;<span class="name">Image</span> <span class="attr">style</span>=<span class="string">&#123;&#123;width:</span> <span class="attr">100</span>, <span class="attr">height:</span> <span class="attr">100</span>, <span class="attr">margin:</span> <span class="attr">10</span>&#125;&#125; <span class="attr">source</span>=<span class="string">&#123;&#123;uri:</span> <span class="attr">res</span>[<span class="attr">2</span>]&#125;&#125;&gt;</span><span class="tag">&lt;/<span class="name">Image</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                    <span class="tag">&lt;/<span class="name">TouchableOpacity</span>&gt;</span></span></span><br><span class="line"><span class="language-xml">                                )</span></span><br><span class="line"><span class="language-xml">                            &#125;</span></span><br><span class="line"><span class="language-xml">                        &#125;</span></span><br><span class="line"><span class="language-xml">                    &#125;</span></span><br><span class="line"><span class="language-xml">                &#125;)&#125;</span></span><br><span class="line"><span class="language-xml">            <span class="tag">&lt;/<span class="name">View</span>&gt;</span></span></span><br><span class="line">        )</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="post-footer"></div><p> (本文完)</p><p> 如果你可以 <a href="/about/give-me-a-coffee.html">点击这个链接打赏我5毛</a>来鼓励我, 非常感谢.</p><p> 本文遵循 <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc/4.0/deed.en">cc协议</a></p><p> 你可以在注明出处和非商用的前提下任意复制及演绎</p><div class="post-footer"></div><div class="tags"><a href="/tags/%E5%85%A5%E9%97%A8/">入门</a><a href="/tags/%E6%AD%A3%E5%88%99/">正则</a></div><div class="post-nav"><a class="pre" href="/2018/05/23/record-a-use-of-jenkins-building-apk/">记录一次使用jenkins来打包apk</a><a class="next" href="/2018/04/23/d3-source-d3-scale/">d3源码之d3-scale</a></div><div id="SOHUCS"></div></div></div></div><div class="pure-u-1 pure-u-md-4-4"><div id="footer"><p>©&nbsp;<a href="/." rel="nofollow">EL PSY CONGROO. </a><a rel="nofollow" target="_blank" href="http://www.miitbeian.gov.cn/">沪ICP备16053193号-2</a></p><p>Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a> | Designed by hahahaha</p></div></div></div></div><script>document.body.className = localStorage.getItem('yo-cwj-theme') || 't1'
</script><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="https://cy-cdn.kuaizhan.com/js/??lib/jquery.js,changyan.labs.https.js?appid=cyt1bgEED" async></script><script>(function () {
    var appid = 'cyt1bgEED';
    var conf = 'prod_20e8d05c4d6b3ce62b89be98ae18390c';
    var width = window.innerWidth || document.documentElement.clientWidth;
    if (width < 960) {
        var head = document.getElementsByTagName('head')[0]||document.head||document.documentElement;
        var script = document.createElement('script');
        script.type = 'text/javascript';
        script.charset = 'utf-8';
        script.id = 'changyan_mobile_js';
        script.src = 'https://cy-cdn.kuaizhan.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf;
        head.appendChild(script);
    } else {
        var loadJs=function(d,a){
        var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;
        var b=document.createElement("script");
        b.setAttribute("type","text/javascript");
        b.setAttribute("charset","UTF-8");b.setAttribute("src",d);
        if(typeof a==="function"){
          if(window.attachEvent){
            b.onreadystatechange=function(){
              var e=b.readyState;
              if(e==="loaded"||e==="complete"){
                b.onreadystatechange=null;
                a();
              }
            }
            }else{
              b.onload=a
            }
          }
          c.appendChild(b)
        };
      loadJs("https://cy-cdn.kuaizhan.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})});
    }
})();
</script><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></html>